---
# PHP Configuration for WordPress
# Optimized for performance and security

# ========================================
# PHP Version
# ========================================
php_version: "8.3"

# ========================================
# PHP-FPM Pool Configuration
# ========================================
php_fpm_pool_name: www
php_fpm_pool_user: www-data
php_fpm_pool_group: www-data
php_fpm_listen: /run/php/php{{ php_version }}-fpm.sock
php_fpm_listen_owner: www-data
php_fpm_listen_group: www-data
php_fpm_listen_mode: "0660"

# Process Manager (dynamic scaling)
php_fpm_pm: dynamic
php_fpm_pm_max_children: 20
php_fpm_pm_start_servers: 4
php_fpm_pm_min_spare_servers: 2
php_fpm_pm_max_spare_servers: 6
php_fpm_pm_max_requests: 500

# Timeout
php_fpm_request_terminate_timeout: 300

# ========================================
# PHP Memory & Execution Limits
# ========================================
php_memory_limit: "256M"
php_max_execution_time: "300"
php_max_input_time: "300"
php_max_input_vars: 3000

# ========================================
# PHP Upload Settings
# ========================================
php_upload_max_filesize: "100M"
php_post_max_size: "100M"
php_file_uploads: "On"
php_max_file_uploads: 20

# ========================================
# PHP Error Handling
# ========================================
php_display_errors: "Off"
php_display_startup_errors: "Off"
php_log_errors: "On"
php_error_reporting: "E_ALL & ~E_DEPRECATED & ~E_STRICT"
php_error_log: /var/log/php{{ php_version }}-fpm-error.log

# ========================================
# PHP Security
# ========================================
php_expose_php: "Off"
php_allow_url_fopen: "On"
php_allow_url_include: "Off"
php_disable_functions:
  - exec
  - passthru
  - shell_exec
  - system
  - proc_open
  - popen
  - curl_exec
  - curl_multi_exec
  - parse_ini_file
  - show_source

# Open basedir restriction (restrict PHP to WordPress directory)
php_open_basedir: "/var/www:/tmp:/usr/share/php"

# ========================================
# PHP Session Configuration
# ========================================
php_session_save_handler: files
php_session_save_path: "/var/lib/php/sessions"
php_session_gc_maxlifetime: 1440
php_session_cookie_httponly: "On"
php_session_cookie_secure: "On"
php_session_use_strict_mode: "On"

# ========================================
# PHP OpCache Configuration
# ========================================
php_opcache_enabled: true
php_opcache_enable: 1
php_opcache_enable_cli: 1
php_opcache_memory_consumption: 128
php_opcache_interned_strings_buffer: 8
php_opcache_max_accelerated_files: 10000
php_opcache_revalidate_freq: 2
php_opcache_fast_shutdown: 1
php_opcache_validate_timestamps: 1

# OpCache optimization
php_opcache_save_comments: 1
php_opcache_enable_file_override: 0

# ========================================
# PHP Realpath Cache
# ========================================
php_realpath_cache_size: "4096K"
php_realpath_cache_ttl: 600

# ========================================
# PHP Date & Timezone
# ========================================
php_date_timezone: "UTC"

# ========================================
# PHP Extensions (Required for WordPress)
# ========================================
php_extensions:
  - php{{ php_version }}-fpm
  - php{{ php_version }}-cli
  - php{{ php_version }}-common
  - php{{ php_version }}-mysql
  - php{{ php_version }}-curl
  - php{{ php_version }}-gd
  - php{{ php_version }}-mbstring
  - php{{ php_version }}-xml
  - php{{ php_version }}-xmlrpc
  - php{{ php_version }}-soap
  - php{{ php_version }}-intl
  - php{{ php_version }}-zip
  - php{{ php_version }}-bcmath
  - php{{ php_version }}-imagick
  - php{{ php_version }}-redis  # For Valkey object cache
  - php{{ php_version }}-opcache

# ========================================
# PHP-FPM Status Page (for monitoring)
# ========================================
php_fpm_status_enabled: true
php_fpm_status_path: /php-fpm-status
php_fpm_ping_enabled: true
php_fpm_ping_path: /php-fpm-ping
