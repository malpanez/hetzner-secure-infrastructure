# Dynamic inventory plugin for Hetzner Cloud
# This reads servers from both Terraform output AND Hetzner API

plugin: hetzner.hcloud.hcloud

# API token from environment
token: "{{ lookup('env', 'HCLOUD_TOKEN') }}"

# Keyed groups by labels
keyed_groups:
  - key: labels.environment
    prefix: env
  - key: labels.project
    prefix: project
  - key: server_type
    prefix: type
  - key: location
    prefix: location

# Compose variables for Ansible
compose:
  ansible_host: ipv4_address
  # Use ansible automation user by default (no 2FA, key-based only)
  # To use your personal account with 2FA, override with: -u malpanez --private-key ~/.ssh/github_ed25519
  ansible_user: malpanez
  ansible_ssh_private_key_file: ~/.ssh/github_ed25519
  server_type: server_type.name
  datacenter: datacenter.name
  
# Groups
groups:
  hetzner: true
  production: labels.environment == "production"
  staging: labels.environment == "staging"
  wordpress_servers: true
  secrets_servers: true
  monitoring_servers: true
  monitored_servers: true
  
# Host variables
hostvar_prefix: hcloud_

# NOPASSWD sudo for admin user
common_admin_user_passwordless_sudo: true