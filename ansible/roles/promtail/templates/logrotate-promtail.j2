# Logrotate configuration for Promtail
# Generated by Ansible - DO NOT EDIT MANUALLY

{{ promtail_log_dir }}/*.log {
    # Rotate when file reaches specified size
    size {{ promtail_logrotate_size }}

    # Keep this many old log files
    rotate {{ promtail_logrotate_rotate }}

    # Rotate daily (in addition to size limit)
    daily

    # Compress old logs
{% if promtail_logrotate_compress %}
    compress
    delaycompress
{% else %}
    nocompress
{% endif %}

    # Don't error if log file is missing
    missingok

    # Don't rotate if log is empty
    notifempty

    # Create new log file with these permissions
    create 0640 {{ promtail_user }} {{ promtail_group }}

    # Use date as suffix for old logs
    dateext
    dateformat -%Y%m%d-%s

    # Post-rotation script
    postrotate
        # Reload Promtail to use new log file
        systemctl reload promtail > /dev/null 2>&1 || true
    endscript

    # Shared scripts run only once
    sharedscripts
}
