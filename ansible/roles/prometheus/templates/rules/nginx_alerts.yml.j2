groups:
  - name: nginx_alerts
    interval: 30s
    rules:
      - alert: NginxDown
        expr: nginx_up == 0
        for: 1m
        labels:
          severity: critical
          service: nginx
        annotations:
          summary: "Nginx is down on {{ $labels.instance }}"
          description: "Nginx exporter cannot connect to Nginx on {{ $labels.instance }} for more than 1 minute."

      - alert: NginxHighErrorRate
        expr: rate(nginx_http_requests_total{status=~"5.."}[5m]) > 1
        for: 5m
        labels:
          severity: warning
          service: nginx
        annotations:
          summary: "High 5xx error rate on {{ $labels.instance }}"
          description: "Nginx is returning {{ $value }} 5xx errors per second on {{ $labels.instance }}."

      - alert: NginxHighConnections
        expr: nginx_connections_active > 1000
        for: 10m
        labels:
          severity: warning
          service: nginx
        annotations:
          summary: "High number of active connections on {{ $labels.instance }}"
          description: "Nginx has {{ $value }} active connections on {{ $labels.instance }}."

      - alert: NginxHighConnectionDropRate
        expr: rate(nginx_connections_dropped_total[5m]) > 10
        for: 5m
        labels:
          severity: warning
          service: nginx
        annotations:
          summary: "High connection drop rate on {{ $labels.instance }}"
          description: "Nginx is dropping {{ $value }} connections per second on {{ $labels.instance }}."

      - alert: NginxHighRequestRate
        expr: rate(nginx_http_requests_total[5m]) > 1000
        for: 10m
        labels:
          severity: info
          service: nginx
        annotations:
          summary: "High request rate on {{ $labels.instance }}"
          description: "Nginx is handling {{ $value }} requests per second on {{ $labels.instance }}. This might indicate a traffic spike."
