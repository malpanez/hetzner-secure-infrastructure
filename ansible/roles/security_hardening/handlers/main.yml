---
- name: reload sysctl
  ansible.builtin.command: sysctl -p /etc/sysctl.d/99-hardening.conf
  register: sysctl_result
  changed_when: true
  failed_when: >
    sysctl_result.rc != 0 and
    'No such file or directory' not in sysctl_result.stderr

- name: restart auditd
  ansible.builtin.service:
    name: auditd
    state: restarted
  failed_when: false  # Don't fail if auditd restart fails (may happen on some kernels)

# NOTE: GRUB/initramfs/reboot handlers are centralized in common/handlers/main.yml
# This role notifies "update grub" which triggers the handler chain there

# NOTE: Los handlers "remount tmp" y "remount shm" han sido ELIMINADOS.
# ansible.posix.mount con state=mounted realiza el mount inmediatamente,
# haciendo innecesarios los handlers de remount.
# Adem√°s, evitamos ignore_errors que ocultaba fallos silenciosamente.
