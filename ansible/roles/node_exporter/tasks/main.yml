---
# Node Exporter Role - Main Tasks (Orchestrator)
# Migrated to use official Prometheus Community APT repository (DEB822 format)

- name: Node Exporter | Main | Load OS-specific variables
  ansible.builtin.include_vars: "{{ ansible_os_family }}.yml"
  tags: [node-exporter, always]

- name: Node Exporter | Main | Check if deployment is enabled
  ansible.builtin.debug:
    msg: "Node Exporter deployment: {{ node_exporter_enabled | default(true) }} on {{ ansible_os_family }}"
  tags: [node-exporter]

- name: Node Exporter | Main | Skip deployment if not enabled
  ansible.builtin.meta: end_play
  when: node_exporter_enabled is defined and not node_exporter_enabled
  tags: [node-exporter]

- name: Node Exporter | Main | Include installation tasks
  ansible.builtin.import_tasks: install.yml
  tags: [node-exporter, install]

- name: Node Exporter | Main | Include configuration tasks
  ansible.builtin.import_tasks: configure.yml
  tags: [node-exporter, config]

- name: Node Exporter | Main | Include service tasks
  ansible.builtin.import_tasks: service.yml
  tags: [node-exporter, service]

- name: Node Exporter | Main | Include firewall tasks
  ansible.builtin.import_tasks: firewall.yml
  tags: [node-exporter, firewall]

- name: Node Exporter | Main | Include validation tasks
  ansible.builtin.import_tasks: validate.yml
  tags: [node-exporter, validate]
