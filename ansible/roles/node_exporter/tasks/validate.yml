---
# Node Exporter Role - Validation Tasks

- name: Node Exporter | Validate | Wait for Node Exporter to be ready
  ansible.builtin.uri:
    url: http://localhost:{{ node_exporter_port }}/metrics
    status_code: 200
  register: result
  until: result.status == 200
  retries: 12
  delay: 5
  tags: [node-exporter, validate]

- name: Node Exporter | Validate | Verify metrics endpoint
  ansible.builtin.uri:
    url: http://localhost:{{ node_exporter_port }}/metrics
    method: GET
    return_content: true
  register: node_exporter_metrics
  tags: [node-exporter, validate]

- name: Node Exporter | Validate | Display status
  ansible.builtin.debug:
    msg: |
      Node Exporter deployed successfully!
      - Metrics endpoint: http://{{ ansible_host }}:{{ node_exporter_port }}/metrics
      - Textfile collector: {{ node_exporter_textfile_dir }}
      - Collectors enabled: {{ node_exporter_enabled_collectors | join(', ') }}
      - Installation method: APT (DEB822 format)
      - Repository: Prometheus Community (Robust Perception)
  tags: [node-exporter, info]
