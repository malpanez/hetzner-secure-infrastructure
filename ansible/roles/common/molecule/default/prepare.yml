---
- name: Prepare
  hosts: all
  become: true

  tasks:
    - name: Update apt cache (with retry for Docker images)
      ansible.builtin.apt:
        update_cache: true
        cache_valid_time: 0
      retries: 3
      delay: 5
      register: apt_update
      until: apt_update is succeeded

    - name: Install locales package
      ansible.builtin.apt:
        name: locales
        state: present
      register: locales_install
      failed_when: false  # Don't fail if package unavailable in container

    - name: Show locales install status
      ansible.builtin.debug:
        msg: "Locales package: {{ 'installed' if locales_install is succeeded else 'skipped (not available in container)' }}"
