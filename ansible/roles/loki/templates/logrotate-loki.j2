# Logrotate configuration for Loki
# Generated by Ansible - DO NOT EDIT MANUALLY

{{ loki_log_dir }}/*.log {
    # Rotate when file reaches specified size
    size {{ loki_logrotate_size }}

    # Keep this many old log files
    rotate {{ loki_logrotate_rotate }}

    # Rotate daily (in addition to size limit)
    daily

    # Compress old logs
{% if loki_logrotate_compress %}
    compress
    delaycompress
{% else %}
    nocompress
{% endif %}

    # Don't error if log file is missing
    missingok

    # Don't rotate if log is empty
    notifempty

    # Create new log file with these permissions
    create 0640 {{ loki_user }} {{ loki_group }}

    # Use date as suffix for old logs
    dateext
    dateformat -%Y%m%d-%s

    # Post-rotation script
    postrotate
        # Reload Loki to use new log file
        systemctl reload loki > /dev/null 2>&1 || true
    endscript

    # Shared scripts run only once
    sharedscripts
}

# Also rotate systemd journal logs if they get too large
# (systemd handles this automatically, but adding explicit config for safety)
