---
# Grafana Role - Main Tasks (Orchestrator)

- name: Grafana | Main | Load OS-specific variables
  ansible.builtin.include_vars: "{{ ansible_os_family }}.yml"
  tags: [grafana, always]

- name: Grafana | Main | Check if deployment is enabled
  ansible.builtin.debug:
    msg: "Grafana deployment: {{ deploy_grafana | default(true) }} on {{ ansible_os_family }}"
  tags: [grafana]

- name: Grafana | Main | Skip Grafana deployment if not enabled
  ansible.builtin.meta: end_play
  when: deploy_grafana is defined and not deploy_grafana
  tags: [grafana]

- name: Grafana | Main | Include installation tasks
  ansible.builtin.import_tasks: install.yml
  tags: [grafana, install]

- name: Grafana | Main | Include configuration tasks
  ansible.builtin.import_tasks: configure.yml
  tags: [grafana, config]

- name: Grafana | Main | Include service tasks
  ansible.builtin.import_tasks: service.yml
  tags: [grafana, service]

- name: Grafana | Main | Include firewall tasks
  ansible.builtin.import_tasks: firewall.yml
  tags: [grafana, firewall]

- name: Grafana | Main | Include validation tasks
  ansible.builtin.import_tasks: validate.yml
  tags: [grafana, validate]
