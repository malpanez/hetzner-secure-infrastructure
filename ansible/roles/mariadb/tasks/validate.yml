---
# MariaDB Role - Validation Tasks

- name: MariaDB | Validate | Wait for MariaDB to be ready
  ansible.builtin.wait_for:
    port: "{{ mariadb_port }}"
    host: "{{ mariadb_bind_address }}"
    delay: 5
    timeout: 60
  tags: [mariadb, validate]

- name: MariaDB | Validate | Get MariaDB version
  ansible.builtin.command:
    cmd: mysql --version
  register: mariadb_version_output
  changed_when: false
  tags: [mariadb, validate]

- name: MariaDB | Validate | Display MariaDB status
  ansible.builtin.debug:
    msg: |
      MariaDB deployed successfully!
      - Version: {{ mariadb_version_output.stdout }}
      - Bind address: {{ mariadb_bind_address }}:{{ mariadb_port }}
      - Databases: {{ mariadb_databases | length }} configured
      - Users: {{ mariadb_users | length }} configured
      - Backup enabled: {{ mariadb_backup_enabled }}
      - Monitoring enabled: {{ mariadb_mysqld_exporter_enabled }}
  tags: [mariadb, info]
