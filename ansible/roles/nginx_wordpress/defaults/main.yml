---
# Nginx WordPress Role - Default Variables
# NOTE: This role assumes MariaDB is already installed via the mariadb role

# ========================================
# Feature Toggles
# ========================================

nginx_wordpress_enabled: true
nginx_wordpress_install_nginx: true
nginx_wordpress_install_php: true
nginx_wordpress_install_wordpress: true

# ========================================
# Nginx Configuration
# ========================================

nginx_wordpress_server_name: example.com
nginx_wordpress_server_aliases:
  - www.example.com

nginx_wordpress_web_root: /var/www/wordpress
nginx_wordpress_nginx_user: www-data
nginx_wordpress_nginx_group: www-data

# SSL/TLS
nginx_wordpress_ssl_enabled: false  # Set to true when certs are configured
nginx_wordpress_ssl_cert_path: /etc/ssl/certs/nginx-wordpress.crt
nginx_wordpress_ssl_key_path: /etc/ssl/private/nginx-wordpress.key

# ========================================
# PHP Configuration
# ========================================

nginx_wordpress_php_version: "8.4"  # Debian 13 has PHP 8.4
nginx_wordpress_php_max_execution_time: 300
nginx_wordpress_php_memory_limit: 256M
nginx_wordpress_php_upload_max_filesize: 64M
nginx_wordpress_php_post_max_size: 64M

# PHP-FPM Performance Tuning (for 2 vCPU, 4GB RAM - CX23)
# Each PHP-FPM process uses ~50-80MB RAM on average
# Formula: (Total RAM - System - MySQL - Nginx - Redis) / PHP process size
# (4096MB - 300MB - 512MB - 50MB - 50MB) / 75MB â‰ˆ 41 max children
# Conservative: 30 max_children to leave headroom for traffic spikes
nginx_wordpress_php_fpm_pm: dynamic
nginx_wordpress_php_fpm_max_children: 30
nginx_wordpress_php_fpm_start_servers: 8
nginx_wordpress_php_fpm_min_spare_servers: 4
nginx_wordpress_php_fpm_max_spare_servers: 12
nginx_wordpress_php_fpm_max_requests: 500
nginx_wordpress_php_fpm_process_idle_timeout: 10s

# ========================================
# WordPress Configuration
# ========================================
# Assumes MariaDB is installed and configured via mariadb role

nginx_wordpress_version: latest

# Database connection (assumes mariadb role created these)
nginx_wordpress_db_name: wordpress
nginx_wordpress_db_user: wordpress
nginx_wordpress_db_password: ""  # MUST be set - should match mariadb role
nginx_wordpress_db_host: localhost

# WordPress security keys (generate with: https://api.wordpress.org/secret-key/1.1/salt/)
nginx_wordpress_auth_key: ""
nginx_wordpress_secure_auth_key: ""
nginx_wordpress_logged_in_key: ""
nginx_wordpress_nonce_key: ""
nginx_wordpress_auth_salt: ""
nginx_wordpress_secure_auth_salt: ""
nginx_wordpress_logged_in_salt: ""
nginx_wordpress_nonce_salt: ""

# ========================================
# WordPress Plugins
# ========================================

# Mandatory plugins (installed automatically)
# Note: Cloudflare handles caching, minification, and CDN
nginx_wordpress_plugins_mandatory:
  # Security
  - wordfence                    # Security & firewall (server-side protection)
  - sucuri-scanner               # Security hardening & monitoring
  - wp-2fa                       # Two-factor authentication

  # Backups
  - updraftplus                  # Automated backups with cloud storage

  # Performance (Backend only - Cloudflare handles frontend)
  - redis-cache                  # Object cache for database queries (requires Valkey)

  # SEO
  - wordpress-seo               # Yoast SEO (metadata, sitemaps, structured data)

  # Media & Content
  - enable-media-replace        # Replace media files preserving URLs

  # Admin & Maintenance
  - wp-mail-smtp               # Reliable transactional email delivery
  - health-check               # Site health & environment monitoring

# Optional plugins (install manually or set to true)
nginx_wordpress_plugins_optional:
  - contact-form-7             # Contact forms
  - elementor                  # Page builder
  - woocommerce               # E-commerce (if needed)

# LMS Plugin (install manually - requires license)
# LearnDash Pro - Commercial plugin, must be installed manually
nginx_wordpress_lms_plugin_manual: learndash  # Reminder: Install manually with license

# WordPress site info
nginx_wordpress_site_title: "My WordPress Site"
nginx_wordpress_admin_user: admin
nginx_wordpress_admin_password: ""  # MUST be set
nginx_wordpress_admin_email: admin@example.com
