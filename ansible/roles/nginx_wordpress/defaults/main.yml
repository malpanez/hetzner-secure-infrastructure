---
# Nginx WordPress Role - Default Variables
# NOTE: This role assumes MariaDB is already installed via the mariadb role

# ========================================
# Feature Toggles
# ========================================

nginx_wordpress_enabled: true
nginx_wordpress_install_nginx: true
nginx_wordpress_install_php: true
nginx_wordpress_install_wordpress: true

# Modular Nginx Configuration Features
nginx_wordpress_enable_fastcgi_cache: true       # FastCGI page caching (30x performance)
nginx_wordpress_enable_rate_limiting: true       # Brute force & DDoS protection
nginx_wordpress_cloudflare_enabled: true         # Cloudflare real IP detection
nginx_wordpress_enable_security_headers: true    # CSP, X-Frame-Options, etc.
nginx_wordpress_learndash_enabled: true          # LearnDash LMS optimizations
nginx_wordpress_woocommerce_enabled: false       # WooCommerce cache bypass

# ========================================
# Nginx Configuration
# ========================================

# Nginx Repository Configuration
nginx_wordpress_use_official_nginx_repo: true   # Use nginx.org official repo (recommended)
nginx_wordpress_nginx_version: "1.28.1"         # Stable version with security fixes
nginx_wordpress_nginx_repo_key_url: "https://nginx.org/keys/nginx_signing.key"
nginx_wordpress_nginx_repo_keyring_path: "/etc/apt/keyrings/nginx-archive-keyring.gpg"
nginx_wordpress_nginx_repo_filename: "nginx-official"
nginx_wordpress_nginx_repo_arch: "amd64"
nginx_wordpress_nginx_repo_pin_priority: 900

nginx_wordpress_server_name: example.com
nginx_wordpress_server_aliases:
  - www.example.com

nginx_wordpress_web_root: /var/www/wordpress
nginx_wordpress_nginx_user: www-data
nginx_wordpress_nginx_group: www-data

# SSL/TLS
nginx_wordpress_ssl_enabled: false  # Set to true when certs are configured
nginx_wordpress_ssl_cert_path: /etc/ssl/certs/nginx-wordpress.crt
nginx_wordpress_ssl_key_path: /etc/ssl/private/nginx-wordpress.key

# Let's Encrypt (DNS-01 via Cloudflare)
nginx_wordpress_letsencrypt_enabled: false
nginx_wordpress_letsencrypt_email: ""
nginx_wordpress_letsencrypt_primary_domain: "{{ nginx_wordpress_server_name }}"
nginx_wordpress_letsencrypt_domains:
  - "{{ nginx_wordpress_server_name }}"
  - "www.{{ nginx_wordpress_server_name }}"
  - "grafana.{{ nginx_wordpress_server_name }}"
  - "prometheus.{{ nginx_wordpress_server_name }}"
nginx_wordpress_letsencrypt_dns_provider: cloudflare
nginx_wordpress_letsencrypt_cloudflare_credentials_path: /etc/letsencrypt/cloudflare.ini
nginx_wordpress_letsencrypt_cloudflare_api_token: "{{ vault_cloudflare_api_token | default('') }}"
nginx_wordpress_letsencrypt_propagation_seconds: 60

# ========================================
# PHP Configuration
# ========================================

nginx_wordpress_php_version: "8.4"  # Debian 13 has PHP 8.4
nginx_wordpress_php_max_execution_time: 300
nginx_wordpress_php_memory_limit: 256M
nginx_wordpress_php_upload_max_filesize: 64M
nginx_wordpress_php_post_max_size: 64M

# PHP-FPM Performance Tuning (for 2 vCPU, 4GB RAM - CX23)
# Each PHP-FPM process uses ~50-80MB RAM on average
# Formula: (Total RAM - System - MySQL - Nginx - Redis) / PHP process size
# (4096MB - 300MB - 512MB - 50MB - 50MB) / 75MB ≈ 41 max children
# Conservative: 30 max_children to leave headroom for traffic spikes
nginx_wordpress_php_fpm_pm: dynamic
nginx_wordpress_php_fpm_max_children: 30
nginx_wordpress_php_fpm_start_servers: 8
nginx_wordpress_php_fpm_min_spare_servers: 4
nginx_wordpress_php_fpm_max_spare_servers: 12
nginx_wordpress_php_fpm_max_requests: 500
nginx_wordpress_php_fpm_process_idle_timeout: 10s

# ========================================
# WordPress Configuration
# ========================================
# Assumes MariaDB is installed and configured via mariadb role

nginx_wordpress_version: latest

# Database connection (assumes mariadb role created these)
nginx_wordpress_db_name: wordpress
nginx_wordpress_db_user: wordpress
nginx_wordpress_db_password: ""  # MUST be set - should match mariadb role
nginx_wordpress_db_host: localhost

# WordPress security keys (generate with: https://api.wordpress.org/secret-key/1.1/salt/)
nginx_wordpress_auth_key: ""
nginx_wordpress_secure_auth_key: ""
nginx_wordpress_logged_in_key: ""
nginx_wordpress_nonce_key: ""
nginx_wordpress_auth_salt: ""
nginx_wordpress_secure_auth_salt: ""
nginx_wordpress_logged_in_salt: ""
nginx_wordpress_nonce_salt: ""

# ========================================
# WordPress Plugins - OPTIMIZED for LearnDash LMS
# ========================================
#
# Infrastructure already provides (NO PLUGINS NEEDED):
# ❌ Caching: Nginx FastCGI + Valkey → NO WP Super Cache/W3 Total Cache
# ❌ Security: Cloudflare WAF + Fail2ban → NO Wordfence Full/Sucuri
# ❌ CDN: Cloudflare → NO Jetpack CDN
# ❌ Rate Limiting: Nginx + Cloudflare → Built-in
#
# Auto-installed plugins organized by priority:

# CRITICAL Infrastructure Integration (4 plugins)
nginx_wordpress_plugins_mandatory:
  - redis-cache                      # Valkey object cache - CRITICAL
  - nginx-helper                     # FastCGI cache purging - CRITICAL
  - wordfence-login-security         # 2FA/MFA for admin - ESSENTIAL
  - limit-login-attempts-reloaded    # Login rate limiting - ESSENTIAL

# CRITICAL LMS Operations (3 plugins)
nginx_wordpress_plugins_lms_critical:
  - updraftplus                      # Backups - CRITICAL (configure with Google Drive/Dropbox)
  - wp-mail-smtp                     # SMTP email - CRITICAL (configure with Brevo Free)
  - seo-by-rank-math                 # SEO - ESSENTIAL (5 keywords free, 20+ schemas)

# Page Builder & Design (Kadence - Gutenberg native, no Elementor needed)
nginx_wordpress_plugins_page_builder:
  - kadence-blocks                   # Advanced Gutenberg blocks - ESSENTIAL
  - kadence-starter-templates        # Kadence template importer

# Accessibility & UX (Neurodivergent-friendly design)
nginx_wordpress_plugins_accessibility:
  - accessibility-assistant          # Reading mask, dyslexia fonts, ADHD mode (free)
  # Alternative premium: readabler (~$29 lifetime) - more features

# IMPORTANT Content & Compliance
nginx_wordpress_plugins_recommended:
  - cookie-notice                    # GDPR cookie consent - IMPORTANT for EU

# Bloat plugins to REMOVE (installed by default in WP)
nginx_wordpress_plugins_remove:
  - hello                            # Hello Dolly - useless
  - akismet                          # Spam protection - not needed without comments

# LMS Plugin (install manually - requires license)
# LearnDash Pro - Commercial plugin, must be installed manually
nginx_wordpress_lms_plugin_manual: learndash

# ========================================
# WordPress Theme Configuration
# ========================================
# Theme is auto-installed and activated via WP-CLI

# Theme selection - Kadence recommended for easy self-design + LearnDash
# Kadence advantages: Gutenberg-native, intuitive customizer, less plugins needed
nginx_wordpress_theme: kadence  # Best for DIY design, LearnDash compatible
nginx_wordpress_theme_activate: true  # Auto-activate after install

# Additional themes to install (not activated)
nginx_wordpress_themes_additional: []

# ========================================
# Starter Templates Configuration (Kadence)
# ========================================
# Import a complete site design via Kadence Starter Templates
# Available FREE templates for LMS:
#   - "Business Courses" (recommended - LearnDash optimized)
#   - "Online Course"
#   - "Digital Course"

nginx_wordpress_starter_template_import: true  # Enable template import
nginx_wordpress_starter_template_name: "Business Courses"  # LearnDash-optimized template
nginx_wordpress_starter_template_id: ""  # Leave empty to auto-discover by name
nginx_wordpress_starter_template_builder: "gutenberg"  # Kadence uses Gutenberg natively
nginx_wordpress_starter_template_reset: false  # Reset existing content before import
nginx_wordpress_starter_template_force: false  # Force re-import even if already imported

# ========================================
# WordPress Site Configuration
# ========================================

# WordPress site info
nginx_wordpress_site_title: "My WordPress Site"
nginx_wordpress_admin_user: admin
nginx_wordpress_admin_password: ""  # MUST be set
nginx_wordpress_admin_email: admin@example.com

# WordPress URL management
nginx_wordpress_site_url: ""
nginx_wordpress_force_url_replace: true

# ========================================
# WordPress Optimization Settings
# ========================================
# Applied via WP-CLI after installation

# Disable comments site-wide (not needed for LMS)
nginx_wordpress_disable_comments: true

# Set timezone (for course schedules, drip content)
nginx_wordpress_timezone: "Europe/Madrid"

# Set date/time format
nginx_wordpress_date_format: "j F Y"  # 18 January 2025
nginx_wordpress_time_format: "H:i"    # 24-hour format

# Permalink structure (SEO-friendly)
nginx_wordpress_permalink_structure: "/%postname%/"

# Disable pingbacks/trackbacks (security + performance)
nginx_wordpress_disable_pingbacks: true

# Limit post revisions (database optimization)
nginx_wordpress_revision_limit: 5
