---
# Nginx WordPress Role - Default Variables
# NOTE: This role assumes MariaDB is already installed via the mariadb role

# ========================================
# Feature Toggles
# ========================================

nginx_wordpress_enabled: true
nginx_wordpress_install_nginx: true
nginx_wordpress_install_php: true
nginx_wordpress_install_wordpress: true

# Modular Nginx Configuration Features
nginx_wordpress_enable_fastcgi_cache: true       # FastCGI page caching (30x performance)
nginx_wordpress_enable_rate_limiting: true       # Brute force & DDoS protection
nginx_wordpress_cloudflare_enabled: true         # Cloudflare real IP detection
nginx_wordpress_enable_security_headers: true    # CSP, X-Frame-Options, etc.
nginx_wordpress_learndash_enabled: true          # LearnDash LMS optimizations
nginx_wordpress_woocommerce_enabled: false       # WooCommerce cache bypass

# ========================================
# Nginx Configuration
# ========================================

# Nginx Repository Configuration
nginx_wordpress_use_official_nginx_repo: true   # Use nginx.org official repo (recommended)
nginx_wordpress_nginx_version: "1.28.1"         # Stable version with security fixes

nginx_wordpress_server_name: example.com
nginx_wordpress_server_aliases:
  - www.example.com

nginx_wordpress_web_root: /var/www/wordpress
nginx_wordpress_nginx_user: www-data
nginx_wordpress_nginx_group: www-data

# SSL/TLS
nginx_wordpress_ssl_enabled: false  # Set to true when certs are configured
nginx_wordpress_ssl_cert_path: /etc/ssl/certs/nginx-wordpress.crt
nginx_wordpress_ssl_key_path: /etc/ssl/private/nginx-wordpress.key

# ========================================
# PHP Configuration
# ========================================

nginx_wordpress_php_version: "8.4"  # Debian 13 has PHP 8.4
nginx_wordpress_php_max_execution_time: 300
nginx_wordpress_php_memory_limit: 256M
nginx_wordpress_php_upload_max_filesize: 64M
nginx_wordpress_php_post_max_size: 64M

# PHP-FPM Performance Tuning (for 2 vCPU, 4GB RAM - CX23)
# Each PHP-FPM process uses ~50-80MB RAM on average
# Formula: (Total RAM - System - MySQL - Nginx - Redis) / PHP process size
# (4096MB - 300MB - 512MB - 50MB - 50MB) / 75MB ≈ 41 max children
# Conservative: 30 max_children to leave headroom for traffic spikes
nginx_wordpress_php_fpm_pm: dynamic
nginx_wordpress_php_fpm_max_children: 30
nginx_wordpress_php_fpm_start_servers: 8
nginx_wordpress_php_fpm_min_spare_servers: 4
nginx_wordpress_php_fpm_max_spare_servers: 12
nginx_wordpress_php_fpm_max_requests: 500
nginx_wordpress_php_fpm_process_idle_timeout: 10s

# ========================================
# WordPress Configuration
# ========================================
# Assumes MariaDB is installed and configured via mariadb role

nginx_wordpress_version: latest

# Database connection (assumes mariadb role created these)
nginx_wordpress_db_name: wordpress
nginx_wordpress_db_user: wordpress
nginx_wordpress_db_password: ""  # MUST be set - should match mariadb role
nginx_wordpress_db_host: localhost

# WordPress security keys (generate with: https://api.wordpress.org/secret-key/1.1/salt/)
nginx_wordpress_auth_key: ""
nginx_wordpress_secure_auth_key: ""
nginx_wordpress_logged_in_key: ""
nginx_wordpress_nonce_key: ""
nginx_wordpress_auth_salt: ""
nginx_wordpress_secure_auth_salt: ""
nginx_wordpress_logged_in_salt: ""
nginx_wordpress_nonce_salt: ""

# ========================================
# WordPress Plugins - OPTIMIZED
# ========================================
#
# Infrastructure already provides (NO PLUGINS NEEDED):
# ❌ Caching: Nginx FastCGI + Valkey → NO WP Super Cache/W3 Total Cache
# ❌ Security: Cloudflare WAF + Fail2ban → NO Wordfence Full/Sucuri
# ❌ CDN: Cloudflare → NO Jetpack CDN
# ❌ Rate Limiting: Nginx + Cloudflare → Built-in
#
# ONLY install these essential plugins (4 mandatory):
nginx_wordpress_plugins_mandatory:
  # Infrastructure Integration (2 plugins)
  - redis-cache                      # Valkey object cache - CRITICAL
  - nginx-helper                     # FastCGI cache purging - CRITICAL

  # Application Security (2 plugins)
  - wordfence-login-security         # 2FA/MFA for admin - ESSENTIAL
  - limit-login-attempts-reloaded    # Login rate limiting - ESSENTIAL

# Optional (only if specifically needed)
nginx_wordpress_plugins_optional:
  - contact-form-7                   # Contact forms (if needed beyond LearnDash)

# LMS Plugin (install manually - requires license)
# LearnDash Pro - Commercial plugin, must be installed manually
nginx_wordpress_lms_plugin_manual: learndash  # Reminder: Install manually with license

# WordPress site info
nginx_wordpress_site_title: "My WordPress Site"
nginx_wordpress_admin_user: admin
nginx_wordpress_admin_password: ""  # MUST be set
nginx_wordpress_admin_email: admin@example.com
